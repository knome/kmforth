
# https://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/

@ "STANDARD" ;

:main { $buffer $fd $addr $1111.cool}
  
  syscall/socket/pf-inet
  syscall/socket/sock-stream
  syscall/socket/ipproto-tcp
  syscall/socket
  "failed to create socket" dieOnError
  
  $fd.set
  
  0x7f000001 qword-little-to-big
  $addr.set
  
  syscall/bind/sockaddr-in4.size memory/map-region
  "failed to create address buffer" dieOnError
  
  dup syscall/bind/af-inet syscall/bind/sockaddr-in4//sin-family.set
  dup 9001                 syscall/bind/sockaddr-in4//sin-port.set
  dup $addr.get            syscall/bind/sockaddr-in4//sin-addr.set
  
  $buffer.set
  
  $fd.get
  $buffer.get
  syscall/bind/sockaddr-in4.size
  syscall/bind
  "failed to bind" dieOnError
  
  "wow" write
  
  [] loop
  
;
